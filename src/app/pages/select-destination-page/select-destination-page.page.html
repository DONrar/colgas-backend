<ion-header [translucent]="true">
  <ion-toolbar style="--background: #132440; --color: white;">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()" style="--color: white;">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>
      <ion-icon name="map-outline" style="color: #3B9797;"></ion-icon>
      &nbsp;Seleccionar Destino
    </ion-title>

    <!-- Controles del mapa en el header -->
    <ion-buttons slot="end">
      <ion-button (click)="centerOnStartLocation()" style="--color: white;">
        <ion-icon name="locate-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [scrollY]="false" [scrollX]="false">
  <!-- Contenedor del mapa - Ocupa toda la pantalla disponible -->
  <div #map id="map" class="map-container"></div>

  <!-- Overlay minimalista para instrucciones -->
  <div class="instructions-overlay" *ngIf="!selectedLocation && !isLoading" (click)="$event.stopPropagation()">
    <div class="instruction-bubble">
      <ion-icon name="hand-left" class="instruction-icon"></ion-icon>
      <span>Toca el mapa para seleccionar destino</span>
    </div>
  </div>

  <!-- Footer minimalista -->
  <div class="map-footer" (click)="$event.stopPropagation()">
    <!-- Estado: Sin selección -->
    <div class="footer-state" *ngIf="!selectedLocation && !isLoading">
      <div class="state-indicator">
        <div class="pulse-dot"></div>
        <span>Selecciona un destino en el mapa</span>
      </div>
    </div>

    <!-- Estado: Con selección -->
    <div class="footer-state selected" *ngIf="selectedLocation">
      <div class="selection-info">
        <div class="selection-status">
          <ion-icon name="checkmark-circle" class="success-icon"></ion-icon>
          <div class="location-coords">
            <span class="coord-text">Destino seleccionado</span>
            <span class="coord-values">{{ selectedLocation.lat | number:'1.4-4' }}, {{ selectedLocation.lng | number:'1.4-4' }}</span>
          </div>
        </div>

        <div class="footer-actions">
          <ion-button fill="clear" size="small" class="btn-clear" (click)="clearSelection()">
            <ion-icon name="close" slot="start"></ion-icon>
            Cambiar
          </ion-button>

          <ion-button class="btn-confirm" (click)="confirmDestination()">
            <ion-icon name="checkmark" slot="start"></ion-icon>
            Confirmar
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Estado: Cargando -->
    <div class="footer-state loading" *ngIf="isLoading">
      <div class="loading-indicator">
        <ion-spinner name="crescent"></ion-spinner>
        <span>Cargando mapa...</span>
      </div>
    </div>
  </div>
</ion-content>
